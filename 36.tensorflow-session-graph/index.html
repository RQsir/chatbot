



<!DOCTYPE html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-0.17.2, mkdocs-material-2.2.1">
    
    
      
        <title>三十六-tensorflow的session和graph - 自己动手做聊天机器人</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application.41c6761c.css">
      
        <link rel="stylesheet" href="../assets/stylesheets/application-palette.792431c1.css">
      
    
    
      <script src="../assets/javascripts/modernizr.1aa3b519.js"></script>
    
    
      
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
      <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    
    
    
  </head>
  
    
    
    
      <body data-md-color-primary="indigo" data-md-color-accent="indigo">
    
  
    <svg class="md-svg">
      <defs>
        
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="drawer">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="search">
    <label class="md-overlay" data-md-component="overlay" for="drawer"></label>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href=".." title="自己动手做聊天机器人" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              <span class="md-header-nav__topic">
                自己动手做聊天机器人
              </span>
              <span class="md-header-nav__topic">
                三十六-tensorflow的session和graph
              </span>
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button" for="search"></label>
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="search"></label>
  <div class="md-search__inner">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" required placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query">
      <label class="md-icon md-search__icon" for="search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset">&#xE5CD;</button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="drawer">
    <span class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </span>
    自己动手做聊天机器人
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="概述" class="md-nav__link">
      概述
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../1.knowledge/" title="一-涉及知识" class="md-nav__link">
      一-涉及知识
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../2.nltk/" title="二-初识NLTK库" class="md-nav__link">
      二-初识NLTK库
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../3.corpus/" title="三-语料与词汇资源" class="md-nav__link">
      三-语料与词汇资源
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../4.pos-tagging/" title="四-自动化词性标注" class="md-nav__link">
      四-自动化词性标注
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../5.text-classification/" title="五-文本分类" class="md-nav__link">
      五-文本分类
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../6.extract/" title="六-结构化提取" class="md-nav__link">
      六-结构化提取
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../7.grammar/" title="七-文法分析" class="md-nav__link">
      七-文法分析
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../8.nlp-review/" title="八-自然语言处理" class="md-nav__link">
      八-自然语言处理
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../9.chatbot/" title="九-聊天机器人怎么做" class="md-nav__link">
      九-聊天机器人怎么做
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../10.pos-ke/" title="十-词性标注与关键词提取" class="md-nav__link">
      十-词性标注与关键词提取
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../11.storage/" title="十一-0字节存储海量语料资源" class="md-nav__link">
      十一-0字节存储海量语料资源
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../12.semantic-dependency/" title="十二-用语言云分析依存句法和语义依存" class="md-nav__link">
      十二-用语言云分析依存句法和语义依存
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../13.linguistic-model/" title="十三-探究语言模型" class="md-nav__link">
      十三-探究语言模型
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../14.participles-art/" title="十四-探究中文分词" class="md-nav__link">
      十四-探究中文分词
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../15.probabilistic-model/" title="十五-概率图模型" class="md-nav__link">
      十五-概率图模型
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../16.bag-material/" title="十六-自然语言处理中的囊中取物" class="md-nav__link">
      十六-自然语言处理中的囊中取物
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../17.specific-mehtod/" title="十七-词性自动标注" class="md-nav__link">
      十七-词性自动标注
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../18.tree/" title="十八-生成句法分析树" class="md-nav__link">
      十八-生成句法分析树
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../19.understand/" title="十九-机器人是怎么理解“日后再说”的" class="md-nav__link">
      十九-机器人是怎么理解“日后再说”的
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../20.pos-base-method/" title="二十-语义角色标注" class="md-nav__link">
      二十-语义角色标注
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../21.tf-idf/" title="二十一-隐含语义索引模型" class="md-nav__link">
      二十一-隐含语义索引模型
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../22.artificial-neural-network/" title="二十二-人工神经网络" class="md-nav__link">
      二十二-人工神经网络
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../23.cnn/" title="二十三-用CNN做深度学习" class="md-nav__link">
      二十三-用CNN做深度学习
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../24.nlp-deep-learning/" title="二十四-将深度学习应用到NLP" class="md-nav__link">
      二十四-将深度学习应用到NLP
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../25.word2vec/" title="二十五-word2vec的实现原理" class="md-nav__link">
      二十五-word2vec的实现原理
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../26.rnn/" title="二十六-递归神经网络(RNN)" class="md-nav__link">
      二十六-递归神经网络(RNN)
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../27.auto-faq/" title="二十七-自动问答" class="md-nav__link">
      二十七-自动问答
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../28.subtitle-corpus/" title="二十八-基于美剧字幕的聊天语料库建设" class="md-nav__link">
      二十八-基于美剧字幕的聊天语料库建设
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../29.corpus-1g/" title="二十九-近1GB的三千万聊天语料" class="md-nav__link">
      二十九-近1GB的三千万聊天语料
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../30.tiny-rabbit/" title="三十-第一版聊天机器人小二兔" class="md-nav__link">
      三十-第一版聊天机器人小二兔
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../31.directive/" title="三十一-把网站流量导向小二兔" class="md-nav__link">
      三十一-把网站流量导向小二兔
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../32.word-vector/" title="三十二-用影视剧字幕语料库生成词向量" class="md-nav__link">
      三十二-用影视剧字幕语料库生成词向量
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../33.lstm-rnn/" title="三十三-LSTM-RNN—有记忆的神经网络" class="md-nav__link">
      三十三-LSTM-RNN—有记忆的神经网络
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../34.torch/" title="三十四-深度学习框架torch" class="md-nav__link">
      三十四-深度学习框架torch
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../35.lstm-learning/" title="三十五-一学会甄嬛体" class="md-nav__link">
      三十五-一学会甄嬛体
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="toc">
    
    
      <label class="md-nav__link md-nav__link--active" for="toc">
        三十六-tensorflow的session和graph
      </label>
    
    <a href="./" title="三十六-tensorflow的session和graph" class="md-nav__link md-nav__link--active">
      三十六-tensorflow的session和graph
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#tensorflow" title="tensorflow中的基本数学运算用法" class="md-nav__link">
    tensorflow中的基本数学运算用法
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tensorflowsession" title="tensorflow的Session是如何工作的" class="md-nav__link">
    tensorflow的Session是如何工作的
  </a>
  
</li>
      
      
      
    </ul>
  
</nav>
    
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../37.tensorflow-lr/" title="三十七-tensorflow中的线性回归" class="md-nav__link">
      三十七-tensorflow中的线性回归
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../38.make-chatbot/" title="三十八-聊天机器人构建流程" class="md-nav__link">
      三十八-聊天机器人构建流程
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../39.gpu-server/" title="三十九-搭建一台GPU共享云服务" class="md-nav__link">
      三十九-搭建一台GPU共享云服务
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../40.video-knowledge-point/" title="四十-视频之开篇宣言与知识点" class="md-nav__link">
      四十-视频之开篇宣言与知识点
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../41.video-python/" title="四十一-视频之环境搭建与python基础" class="md-nav__link">
      四十一-视频之环境搭建与python基础
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../42.practice/" title="四十二-从理论到实践开发聊天机器人1" class="md-nav__link">
      四十二-从理论到实践开发聊天机器人1
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../43.practice2/" title="四十三-从理论到实践开发聊天机器人2" class="md-nav__link">
      四十三-从理论到实践开发聊天机器人2
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#tensorflow" title="tensorflow中的基本数学运算用法" class="md-nav__link">
    tensorflow中的基本数学运算用法
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tensorflowsession" title="tensorflow的Session是如何工作的" class="md-nav__link">
    tensorflow的Session是如何工作的
  </a>
  
</li>
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                  <h1>三十六-tensorflow的session和graph</h1>
                
                <p>tensorflow作为一个基于图结构的深度学习框架，内部通过session实现图和计算内核的交互，那么这个图是什么样的结构，session的工作原理又是什么样的呢？我们通过几段代码来深入理解一下 </p>
<h3 id="tensorflow">tensorflow中的基本数学运算用法<a class="headerlink" href="#tensorflow" title="Permanent link">&para;</a></h3>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kn">import</span> <span class="nn">tensorflow</span> <span class="kn">as</span> <span class="nn">tf</span>

<span class="n">sess</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">Session</span><span class="p">()</span>

<span class="n">a</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">placeholder</span><span class="p">(</span><span class="s2">&quot;float&quot;</span><span class="p">)</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">placeholder</span><span class="p">(</span><span class="s2">&quot;float&quot;</span><span class="p">)</span>
<span class="n">c</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">constant</span><span class="p">(</span><span class="mf">6.0</span><span class="p">)</span>
<span class="n">d</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">mul</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">mul</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>
<span class="k">print</span> <span class="n">sess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">feed_dict</span><span class="o">=</span><span class="p">{</span><span class="n">a</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="mi">3</span><span class="p">})</span>

<span class="n">A</span> <span class="o">=</span> <span class="p">[[</span><span class="mf">1.1</span><span class="p">,</span><span class="mf">2.3</span><span class="p">],[</span><span class="mf">3.4</span><span class="p">,</span><span class="mf">4.1</span><span class="p">]]</span>
<span class="n">Y</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">matrix_inverse</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
<span class="k">print</span> <span class="n">sess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">Y</span><span class="p">)</span>
<span class="n">sess</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</td></tr></table>

<p>主要数字运算还包括：</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>tf.add
tf.sub
tf.mul
tf.div
tf.mod
tf.abs
tf.neg
tf.sign
tf.inv
tf.square
tf.round
tf.sqrt
tf.pow
tf.exp
tf.log
tf.maximum
tf.minimum
tf.cos
tf.sin
</pre></div>
</td></tr></table>

<p>主要矩阵运算还包括：</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>tf.diag生成对角阵
tf.transpose
tf.matmul
tf.matrix_determinant计算行列式的值
tf.matrix_inverse计算矩阵的逆
</pre></div>
</td></tr></table>

<p>插播小甜点：tensorboard使用
tensorflow因为代码执行过程是先构建图，然后在执行，所以对中间过程的调试不太方便，所以提供了一个tensorboard工具来便于调试，用法如下：</p>
<p>在训练时会提示写入事件文件到哪个目录(比如：/tmp/tflearn_logs/11U8M4/)</p>
<p>执行如下命令并打开http://192.168.1.101:6006就能看到tensorboard的界面</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="n">tensorboard</span> <span class="o">--</span><span class="n">logdir</span><span class="o">=/</span><span class="n">tmp</span><span class="o">/</span><span class="n">tflearn_logs</span><span class="o">/</span><span class="mi">11</span><span class="n">U8M4</span><span class="o">/</span>
 <span class="sb">``</span><span class="err">`</span>

<span class="c1">### 什么是Graph和Session</span>

<span class="err">为了步入正题，我们通过一段代码来展示</span><span class="n">Graph</span><span class="err">和</span><span class="n">Session</span><span class="err">的使用</span>

<span class="sb">``</span><span class="err">`</span><span class="n">python</span>
<span class="kn">import</span> <span class="nn">tensorflow</span> <span class="kn">as</span> <span class="nn">tf</span>

<span class="k">with</span> <span class="n">tf</span><span class="o">.</span><span class="n">Graph</span><span class="p">()</span><span class="o">.</span><span class="n">as_default</span><span class="p">()</span> <span class="k">as</span> <span class="n">g</span><span class="p">:</span>
    <span class="k">with</span> <span class="n">g</span><span class="o">.</span><span class="n">name_scope</span><span class="p">(</span><span class="s2">&quot;myscope&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">scope</span><span class="p">:</span> <span class="c1"># 有了这个scope，下面的op的name都是类似myscope/Placeholder这样的前缀</span>
        <span class="n">sess</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">Session</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">graph</span> <span class="o">=</span> <span class="n">g</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span> <span class="c1"># target表示要连接的tf执行引擎</span>
        <span class="k">print</span> <span class="s2">&quot;graph version:&quot;</span><span class="p">,</span> <span class="n">g</span><span class="o">.</span><span class="n">version</span> <span class="c1"># 0</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">placeholder</span><span class="p">(</span><span class="s2">&quot;float&quot;</span><span class="p">)</span>
        <span class="k">print</span> <span class="n">a</span><span class="o">.</span><span class="n">op</span> <span class="c1"># 输出整个operation信息，跟下面g.get_operations返回结果一样</span>
        <span class="k">print</span> <span class="s2">&quot;graph version:&quot;</span><span class="p">,</span> <span class="n">g</span><span class="o">.</span><span class="n">version</span> <span class="c1"># 1</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">placeholder</span><span class="p">(</span><span class="s2">&quot;float&quot;</span><span class="p">)</span>
        <span class="k">print</span> <span class="s2">&quot;graph version:&quot;</span><span class="p">,</span> <span class="n">g</span><span class="o">.</span><span class="n">version</span> <span class="c1"># 2</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">placeholder</span><span class="p">(</span><span class="s2">&quot;float&quot;</span><span class="p">)</span>
        <span class="k">print</span> <span class="s2">&quot;graph version:&quot;</span><span class="p">,</span> <span class="n">g</span><span class="o">.</span><span class="n">version</span> <span class="c1"># 3</span>
        <span class="n">y1</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">mul</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span> <span class="c1"># 也可以写成a * b</span>
        <span class="k">print</span> <span class="s2">&quot;graph version:&quot;</span><span class="p">,</span> <span class="n">g</span><span class="o">.</span><span class="n">version</span> <span class="c1"># 4</span>
        <span class="n">y2</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">mul</span><span class="p">(</span><span class="n">y1</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span> <span class="c1"># 也可以写成y1 * c</span>
        <span class="k">print</span> <span class="s2">&quot;graph version:&quot;</span><span class="p">,</span> <span class="n">g</span><span class="o">.</span><span class="n">version</span> <span class="c1"># 5</span>
        <span class="n">operations</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">get_operations</span><span class="p">()</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">op</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">operations</span><span class="p">):</span>
            <span class="k">print</span> <span class="s2">&quot;============ operation&quot;</span><span class="p">,</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;===========&quot;</span>
            <span class="k">print</span> <span class="n">op</span> <span class="c1"># 一个结构，包括：name、op、attr、input等,不同op不一样</span>
        <span class="k">assert</span> <span class="n">y1</span><span class="o">.</span><span class="n">graph</span> <span class="ow">is</span> <span class="n">g</span>
        <span class="k">assert</span> <span class="n">sess</span><span class="o">.</span><span class="n">graph</span> <span class="ow">is</span> <span class="n">g</span>
        <span class="k">print</span> <span class="s2">&quot;================ graph object address ================&quot;</span>
        <span class="k">print</span> <span class="n">sess</span><span class="o">.</span><span class="n">graph</span>
        <span class="k">print</span> <span class="s2">&quot;================ graph define ================&quot;</span>
        <span class="k">print</span> <span class="n">sess</span><span class="o">.</span><span class="n">graph_def</span>
        <span class="k">print</span> <span class="s2">&quot;================ sess str ================&quot;</span>
        <span class="k">print</span> <span class="n">sess</span><span class="o">.</span><span class="n">sess_str</span>
        <span class="k">print</span> <span class="n">sess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">y1</span><span class="p">,</span> <span class="n">feed_dict</span><span class="o">=</span><span class="p">{</span><span class="n">a</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="mi">3</span><span class="p">})</span> <span class="c1"># 9.0 feed_dictgraph中的元素和值的映射</span>
        <span class="k">print</span> <span class="n">sess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">fetches</span><span class="o">=</span><span class="p">[</span><span class="n">b</span><span class="p">,</span><span class="n">y1</span><span class="p">],</span> <span class="n">feed_dict</span><span class="o">=</span><span class="p">{</span><span class="n">a</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="mi">3</span><span class="p">},</span> <span class="n">options</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">run_metadata</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span> <span class="c1"># 传入的feches和返回值的shape相同</span>
        <span class="k">print</span> <span class="n">sess</span><span class="o">.</span><span class="n">run</span><span class="p">({</span><span class="s1">&#39;ret_name&#39;</span><span class="p">:</span><span class="n">y1</span><span class="p">},</span> <span class="n">feed_dict</span><span class="o">=</span><span class="p">{</span><span class="n">a</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="mi">3</span><span class="p">})</span> <span class="c1"># {&#39;ret_name&#39;: 9.0} 传入的feches和返回值的shape相同</span>

        <span class="k">assert</span> <span class="n">tf</span><span class="o">.</span><span class="n">get_default_session</span><span class="p">()</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">sess</span>
        <span class="k">with</span> <span class="n">sess</span><span class="o">.</span><span class="n">as_default</span><span class="p">():</span> <span class="c1"># 把sess作为默认的session，那么tf.get_default_session就是sess, 否则不是</span>
            <span class="k">assert</span> <span class="n">tf</span><span class="o">.</span><span class="n">get_default_session</span><span class="p">()</span> <span class="ow">is</span> <span class="n">sess</span>

        <span class="n">h</span> <span class="o">=</span> <span class="n">sess</span><span class="o">.</span><span class="n">partial_run_setup</span><span class="p">([</span><span class="n">y1</span><span class="p">,</span> <span class="n">y2</span><span class="p">],</span> <span class="p">[</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">])</span> <span class="c1"># 分阶段运行，参数指明了feches和feed_dict列表</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">sess</span><span class="o">.</span><span class="n">partial_run</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">feed_dict</span><span class="o">=</span><span class="p">{</span><span class="n">a</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="mi">4</span><span class="p">})</span> <span class="c1"># 12 运行第一阶段</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">sess</span><span class="o">.</span><span class="n">partial_run</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">feed_dict</span><span class="o">=</span><span class="p">{</span><span class="n">c</span><span class="p">:</span> <span class="n">res</span><span class="p">})</span> <span class="c1"># 144.0 运行第二阶段，其中使用了第一阶段的执行结果</span>
        <span class="k">print</span> <span class="s2">&quot;partial_run res:&quot;</span><span class="p">,</span> <span class="n">res</span>
        <span class="n">sess</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</td></tr></table>

<p>输出如下：</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="n">graph</span> <span class="n">version</span><span class="p">:</span> <span class="mi">0</span>
<span class="n">name</span><span class="p">:</span> <span class="s2">&quot;myscope/Placeholder&quot;</span>
<span class="n">op</span><span class="p">:</span> <span class="s2">&quot;Placeholder&quot;</span>
<span class="n">attr</span> <span class="p">{</span>
  <span class="n">key</span><span class="p">:</span> <span class="s2">&quot;dtype&quot;</span>
  <span class="n">value</span> <span class="p">{</span>
    <span class="nb">type</span><span class="p">:</span> <span class="n">DT_FLOAT</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="n">attr</span> <span class="p">{</span>
  <span class="n">key</span><span class="p">:</span> <span class="s2">&quot;shape&quot;</span>
  <span class="n">value</span> <span class="p">{</span>
    <span class="n">shape</span> <span class="p">{</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="n">graph</span> <span class="n">version</span><span class="p">:</span> <span class="mi">1</span>
<span class="n">graph</span> <span class="n">version</span><span class="p">:</span> <span class="mi">2</span>
<span class="n">graph</span> <span class="n">version</span><span class="p">:</span> <span class="mi">3</span>
<span class="n">graph</span> <span class="n">version</span><span class="p">:</span> <span class="mi">4</span>
<span class="n">graph</span> <span class="n">version</span><span class="p">:</span> <span class="mi">5</span>
<span class="o">============</span> <span class="n">operation</span> <span class="mi">1</span> <span class="o">===========</span>
<span class="n">name</span><span class="p">:</span> <span class="s2">&quot;myscope/Placeholder&quot;</span>
<span class="n">op</span><span class="p">:</span> <span class="s2">&quot;Placeholder&quot;</span>
<span class="n">attr</span> <span class="p">{</span>
  <span class="n">key</span><span class="p">:</span> <span class="s2">&quot;dtype&quot;</span>
  <span class="n">value</span> <span class="p">{</span>
    <span class="nb">type</span><span class="p">:</span> <span class="n">DT_FLOAT</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="n">attr</span> <span class="p">{</span>
  <span class="n">key</span><span class="p">:</span> <span class="s2">&quot;shape&quot;</span>
  <span class="n">value</span> <span class="p">{</span>
    <span class="n">shape</span> <span class="p">{</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="o">============</span> <span class="n">operation</span> <span class="mi">2</span> <span class="o">===========</span>
<span class="n">name</span><span class="p">:</span> <span class="s2">&quot;myscope/Placeholder_1&quot;</span>
<span class="n">op</span><span class="p">:</span> <span class="s2">&quot;Placeholder&quot;</span>
<span class="n">attr</span> <span class="p">{</span>
  <span class="n">key</span><span class="p">:</span> <span class="s2">&quot;dtype&quot;</span>
  <span class="n">value</span> <span class="p">{</span>
    <span class="nb">type</span><span class="p">:</span> <span class="n">DT_FLOAT</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="n">attr</span> <span class="p">{</span>
  <span class="n">key</span><span class="p">:</span> <span class="s2">&quot;shape&quot;</span>
  <span class="n">value</span> <span class="p">{</span>
    <span class="n">shape</span> <span class="p">{</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="o">============</span> <span class="n">operation</span> <span class="mi">3</span> <span class="o">===========</span>
<span class="n">name</span><span class="p">:</span> <span class="s2">&quot;myscope/Placeholder_2&quot;</span>
<span class="n">op</span><span class="p">:</span> <span class="s2">&quot;Placeholder&quot;</span>
<span class="n">attr</span> <span class="p">{</span>
  <span class="n">key</span><span class="p">:</span> <span class="s2">&quot;dtype&quot;</span>
  <span class="n">value</span> <span class="p">{</span>
    <span class="nb">type</span><span class="p">:</span> <span class="n">DT_FLOAT</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="n">attr</span> <span class="p">{</span>
  <span class="n">key</span><span class="p">:</span> <span class="s2">&quot;shape&quot;</span>
  <span class="n">value</span> <span class="p">{</span>
    <span class="n">shape</span> <span class="p">{</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="o">============</span> <span class="n">operation</span> <span class="mi">4</span> <span class="o">===========</span>
<span class="n">name</span><span class="p">:</span> <span class="s2">&quot;myscope/Mul&quot;</span>
<span class="n">op</span><span class="p">:</span> <span class="s2">&quot;Mul&quot;</span>
<span class="nb">input</span><span class="p">:</span> <span class="s2">&quot;myscope/Placeholder&quot;</span>
<span class="nb">input</span><span class="p">:</span> <span class="s2">&quot;myscope/Placeholder_1&quot;</span>
<span class="n">attr</span> <span class="p">{</span>
  <span class="n">key</span><span class="p">:</span> <span class="s2">&quot;T&quot;</span>
  <span class="n">value</span> <span class="p">{</span>
    <span class="nb">type</span><span class="p">:</span> <span class="n">DT_FLOAT</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="o">============</span> <span class="n">operation</span> <span class="mi">5</span> <span class="o">===========</span>
<span class="n">name</span><span class="p">:</span> <span class="s2">&quot;myscope/Mul_1&quot;</span>
<span class="n">op</span><span class="p">:</span> <span class="s2">&quot;Mul&quot;</span>
<span class="nb">input</span><span class="p">:</span> <span class="s2">&quot;myscope/Mul&quot;</span>
<span class="nb">input</span><span class="p">:</span> <span class="s2">&quot;myscope/Placeholder_2&quot;</span>
<span class="n">attr</span> <span class="p">{</span>
  <span class="n">key</span><span class="p">:</span> <span class="s2">&quot;T&quot;</span>
  <span class="n">value</span> <span class="p">{</span>
    <span class="nb">type</span><span class="p">:</span> <span class="n">DT_FLOAT</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="o">================</span> <span class="n">graph</span> <span class="nb">object</span> <span class="n">address</span> <span class="o">================</span>
<span class="o">&lt;</span><span class="n">tensorflow</span><span class="o">.</span><span class="n">python</span><span class="o">.</span><span class="n">framework</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">Graph</span> <span class="nb">object</span> <span class="n">at</span> <span class="mh">0x1138702d0</span><span class="o">&gt;</span>
<span class="o">================</span> <span class="n">graph</span> <span class="n">define</span> <span class="o">================</span>
<span class="n">node</span> <span class="p">{</span>
  <span class="n">name</span><span class="p">:</span> <span class="s2">&quot;myscope/Placeholder&quot;</span>
  <span class="n">op</span><span class="p">:</span> <span class="s2">&quot;Placeholder&quot;</span>
  <span class="n">attr</span> <span class="p">{</span>
    <span class="n">key</span><span class="p">:</span> <span class="s2">&quot;dtype&quot;</span>
    <span class="n">value</span> <span class="p">{</span>
      <span class="nb">type</span><span class="p">:</span> <span class="n">DT_FLOAT</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="n">attr</span> <span class="p">{</span>
    <span class="n">key</span><span class="p">:</span> <span class="s2">&quot;shape&quot;</span>
    <span class="n">value</span> <span class="p">{</span>
      <span class="n">shape</span> <span class="p">{</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="n">node</span> <span class="p">{</span>
  <span class="n">name</span><span class="p">:</span> <span class="s2">&quot;myscope/Placeholder_1&quot;</span>
  <span class="n">op</span><span class="p">:</span> <span class="s2">&quot;Placeholder&quot;</span>
  <span class="n">attr</span> <span class="p">{</span>
    <span class="n">key</span><span class="p">:</span> <span class="s2">&quot;dtype&quot;</span>
    <span class="n">value</span> <span class="p">{</span>
      <span class="nb">type</span><span class="p">:</span> <span class="n">DT_FLOAT</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="n">attr</span> <span class="p">{</span>
    <span class="n">key</span><span class="p">:</span> <span class="s2">&quot;shape&quot;</span>
    <span class="n">value</span> <span class="p">{</span>
      <span class="n">shape</span> <span class="p">{</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="n">node</span> <span class="p">{</span>
  <span class="n">name</span><span class="p">:</span> <span class="s2">&quot;myscope/Placeholder_2&quot;</span>
  <span class="n">op</span><span class="p">:</span> <span class="s2">&quot;Placeholder&quot;</span>
  <span class="n">attr</span> <span class="p">{</span>
    <span class="n">key</span><span class="p">:</span> <span class="s2">&quot;dtype&quot;</span>
    <span class="n">value</span> <span class="p">{</span>
      <span class="nb">type</span><span class="p">:</span> <span class="n">DT_FLOAT</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="n">attr</span> <span class="p">{</span>
    <span class="n">key</span><span class="p">:</span> <span class="s2">&quot;shape&quot;</span>
    <span class="n">value</span> <span class="p">{</span>
      <span class="n">shape</span> <span class="p">{</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="n">node</span> <span class="p">{</span>
  <span class="n">name</span><span class="p">:</span> <span class="s2">&quot;myscope/Mul&quot;</span>
  <span class="n">op</span><span class="p">:</span> <span class="s2">&quot;Mul&quot;</span>
  <span class="nb">input</span><span class="p">:</span> <span class="s2">&quot;myscope/Placeholder&quot;</span>
  <span class="nb">input</span><span class="p">:</span> <span class="s2">&quot;myscope/Placeholder_1&quot;</span>
  <span class="n">attr</span> <span class="p">{</span>
    <span class="n">key</span><span class="p">:</span> <span class="s2">&quot;T&quot;</span>
    <span class="n">value</span> <span class="p">{</span>
      <span class="nb">type</span><span class="p">:</span> <span class="n">DT_FLOAT</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="n">node</span> <span class="p">{</span>
  <span class="n">name</span><span class="p">:</span> <span class="s2">&quot;myscope/Mul_1&quot;</span>
  <span class="n">op</span><span class="p">:</span> <span class="s2">&quot;Mul&quot;</span>
  <span class="nb">input</span><span class="p">:</span> <span class="s2">&quot;myscope/Mul&quot;</span>
  <span class="nb">input</span><span class="p">:</span> <span class="s2">&quot;myscope/Placeholder_2&quot;</span>
  <span class="n">attr</span> <span class="p">{</span>
    <span class="n">key</span><span class="p">:</span> <span class="s2">&quot;T&quot;</span>
    <span class="n">value</span> <span class="p">{</span>
      <span class="nb">type</span><span class="p">:</span> <span class="n">DT_FLOAT</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="n">versions</span> <span class="p">{</span>
  <span class="n">producer</span><span class="p">:</span> <span class="mi">15</span>
<span class="p">}</span>

<span class="o">================</span> <span class="n">sess</span> <span class="nb">str</span> <span class="o">================</span>

<span class="mf">9.0</span>
<span class="p">[</span><span class="n">array</span><span class="p">(</span><span class="mf">3.0</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">float32</span><span class="p">),</span> <span class="mf">9.0</span><span class="p">]</span>
<span class="p">{</span><span class="s1">&#39;ret_name&#39;</span><span class="p">:</span> <span class="mf">9.0</span><span class="p">}</span>
<span class="n">partial_run</span> <span class="n">res</span><span class="p">:</span> <span class="mf">144.0</span>
</pre></div>
</td></tr></table>

<h3 id="tensorflowsession">tensorflow的Session是如何工作的<a class="headerlink" href="#tensorflowsession" title="Permanent link">&para;</a></h3>
<p>Session是Graph和执行者之间的媒介，Session.run()实际上将graph、fetches、feed_dict序列化到字节数组中，并调用tf_session.TF_Run（参见/usr/local/lib/python2.7/site-packages/tensorflow/python/client/session.py）</p>
<p>而这里的tf_session.TF_Run实际上调用了动态链接库_pywrap_tensorflow.so中实现的_pywrap_tensorflow.TF_Run接口(参见/usr/local/lib/python2.7/site-packages/tensorflow/python/pywrap_tensorflow.py)，这个动态链接库是tensorflow提供的诸多语言接口中python语言的接口</p>
<p>事实上这里的_pywrap_tensorflow.so和pywrap_tensorflow.py是通过SWIG工具自动生成，大家都知道tensorflow核心语言是c语言，这里是通过SWIG生成了各种脚本语言的接口</p>
                
                  
                
              
              
                
              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../35.lstm-learning/" title="三十五-一学会甄嬛体" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                三十五-一学会甄嬛体
              </span>
            </div>
          </a>
        
        
          <a href="../37.tensorflow-lr/" title="三十七-tensorflow中的线性回归" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                三十七-tensorflow中的线性回归
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="http://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
        
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application.6cdc17f0.js"></script>
      
      <script>app.initialize({version:"0.17.2",url:{base:".."}})</script>
      
    
    
      
    
  </body>
</html>